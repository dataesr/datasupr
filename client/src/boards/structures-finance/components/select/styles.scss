/* ============================================================================
   Shared Popover Styles for Dropdown and Select

   Uses multi-selector pattern to share styles while keeping semantic class names.
   - fx-dropdown__* for Dropdown component
   - fx-select__* for Select component
   ============================================================================ */

/* -----------------------------------------------------------------------------
   Container - provides positioning context
   ----------------------------------------------------------------------------- */
.fx-dropdown,
.fx-select {
  position: relative;
  display: inline-block;
}

.fx-dropdown--full-width,
.fx-select--full-width {
  display: block;
  width: 100%;
}

/* -----------------------------------------------------------------------------
   Trigger button - with arrow indicator
   ----------------------------------------------------------------------------- */
.fr-btn.fx-dropdown__trigger--full-width,
.fr-btn.fx-select__trigger--full-width {
  display: inline-flex;
  flex-direction: row;
  align-items: center;
  width: 100%;
  text-align: left;
  white-space: normal;
  word-break: break-word;
}

.fx-dropdown
  .fr-btn.fx-dropdown__trigger--full-width.fx-dropdown__trigger--has-arrow::after,
.fx-select
  .fr-btn.fx-select__trigger--full-width.fx-select__trigger--has-arrow::after {
  margin-left: auto;
  margin-right: 0;
}

.fx-dropdown .fx-dropdown__trigger.fx-dropdown__trigger--has-arrow::after,
.fx-select .fx-select__trigger.fx-select__trigger--has-arrow::after {
  --icon-size: 1rem;
  flex: 0 0 auto;
  display: inline-block;
  vertical-align: calc((0.75em - var(--icon-size)) * 0.5);
  background-color: currentColor;
  width: var(--icon-size);
  height: var(--icon-size);
  -webkit-mask-size: 100% 100%;
  mask-size: 100% 100%;
  -webkit-mask-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'%3E%3Cpath d='m12 13.172 4.95-4.95 1.414 1.414L12 16 5.636 9.636 7.05 8.222l4.95 4.95z'/%3E%3C/svg%3E");
  mask-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'%3E%3Cpath d='m12 13.172 4.95-4.95 1.414 1.414L12 16 5.636 9.636 7.05 8.222l4.95 4.95z'/%3E%3C/svg%3E");
  content: "";
  margin-left: 0.25rem;
  margin-right: -0.25rem;
  transition: transform 0.3s;
}

/* Override for DSFR icon buttons */
.fx-dropdown
  .fx-dropdown__trigger.fx-dropdown__trigger--has-arrow[class*="fr-icon-"]::after,
.fx-select
  .fx-select__trigger.fx-select__trigger--has-arrow[class*="fr-icon-"]::after {
  -webkit-mask-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'%3E%3Cpath d='m12 13.172 4.95-4.95 1.414 1.414L12 16 5.636 9.636 7.05 8.222l4.95 4.95z'/%3E%3C/svg%3E");
  mask-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'%3E%3Cpath d='m12 13.172 4.95-4.95 1.414 1.414L12 16 5.636 9.636 7.05 8.222l4.95 4.95z'/%3E%3C/svg%3E");
  content: "";
}

.fx-dropdown
  .fx-dropdown__trigger.fx-dropdown__trigger--has-arrow[aria-expanded="true"]::after,
.fx-select
  .fx-select__trigger.fx-select__trigger--has-arrow[aria-expanded="true"]::after {
  transform: rotate(-180deg);
}

/* Arrow size variants */
.fx-dropdown--sm .fx-dropdown__trigger.fx-dropdown__trigger--has-arrow::after,
.fx-select--sm .fx-select__trigger.fx-select__trigger--has-arrow::after {
  --icon-size: 0.875rem;
}

.fx-dropdown--lg .fx-dropdown__trigger.fx-dropdown__trigger--has-arrow::after,
.fx-select--lg .fx-select__trigger.fx-select__trigger--has-arrow::after {
  --icon-size: 1.25rem;
}

/* Open state styling */
.fx-dropdown__trigger[aria-expanded="true"],
.fx-select__trigger[aria-expanded="true"] {
  color: var(--text-active-blue-france);
  background-color: var(--background-open-blue-france);
  --idle: transparent;
  --hover: var(--background-open-blue-france-hover);
  --active: var(--background-open-blue-france-active);
}

.fx-dropdown__trigger[aria-expanded="true"]:hover,
.fx-select__trigger[aria-expanded="true"]:hover {
  background-color: var(--hover-tint);
}

.fx-dropdown__trigger[aria-expanded="true"]:active,
.fx-select__trigger[aria-expanded="true"]:active {
  background-color: var(--active-tint);
}

/* -----------------------------------------------------------------------------
   Popover - collapse mechanism + positioning
   ----------------------------------------------------------------------------- */
.fx-dropdown__popover,
.fx-select__popover {
  --collapse-max-height: none;
  overflow: hidden;
  max-height: var(--collapse-max-height);
  visibility: hidden;
  transition:
    visibility 0.15s,
    max-height 0.15s;

  position: absolute;
  top: 100%;
  left: 0;
  z-index: calc(var(--ground, 0) + 1000);
  pointer-events: none;

  margin: 0;
  padding: 0;
  filter: drop-shadow(var(--overlap-shadow, 0 6px 18px rgba(0, 0, 18, 0.16)));
  min-width: 100%;
}

.fx-dropdown--full-width .fx-dropdown__popover,
.fx-select--full-width .fx-select__popover {
  min-width: 100%;
  width: max-content;
}

.fx-dropdown__popover:not(.fx-dropdown__popover--expanded),
.fx-select__popover:not(.fx-select__popover--expanded) {
  --collapse-max-height: 0;
}

.fx-dropdown__popover--expanded,
.fx-select__popover--expanded {
  visibility: visible;
  pointer-events: auto;
  overflow-x: hidden;
  overflow-y: auto;
  max-height: calc(100vh - 10rem);
}

.fx-dropdown__popover--align-end,
.fx-select__popover--align-end {
  left: auto;
  right: 0;
}

/* -----------------------------------------------------------------------------
   Popover inner - the visible content area
   ----------------------------------------------------------------------------- */
.fx-dropdown__popover-inner,
.fx-select__popover-inner {
  display: flex;
  flex-direction: column;
  max-height: inherit;
  min-width: max-content;
  max-width: calc(100vw - 2rem);
  pointer-events: auto;
  padding: 0;
  margin: 0;

  background-color: var(--background-overlap-grey, #fff);
  background-image: linear-gradient(
    0deg,
    var(--background-open-blue-france, #000091),
    var(--background-open-blue-france, #000091)
  );
  background-size: 100% 2px;
  background-position: 0 0;
  background-repeat: no-repeat;

  --idle: transparent;
  --hover: var(--background-overlap-grey-hover, rgba(0, 0, 0, 0.05));
  --active: var(--background-overlap-grey-active, rgba(0, 0, 0, 0.1));
}

/* -----------------------------------------------------------------------------
   Content - scrollable container for items
   ----------------------------------------------------------------------------- */
.fx-dropdown__content,
.fx-select__content {
  flex: 1 1 auto;
  min-height: 0;
  overflow-y: auto;
  overflow-x: hidden;
}

/* List reset */
.fx-dropdown__popover-inner ul,
.fx-dropdown__popover-inner ol,
.fx-select__popover-inner ul,
.fx-select__popover-inner ol {
  list-style: none;
  padding: 0;
  margin: 0;
}

.fx-dropdown__popover-inner li,
.fx-select__popover-inner li {
  padding: 0;
  margin: 0;
}

/* -----------------------------------------------------------------------------
   Group - for grouping related items
   ----------------------------------------------------------------------------- */
.fx-dropdown__group,
.fx-select__group {
  margin: 0;
  padding: 0.25rem 0;
  background-color: var(--background-overlap-grey, #fff);
  box-shadow: inset 0px 1px 0px 0px var(--border-default-grey);
}

.fx-dropdown__group:first-child,
.fx-select__group:first-child {
  box-shadow: none;
}

.fx-dropdown__group-label,
.fx-select__group-label {
  padding: 0.5rem 1rem 0.25rem;
  font-size: 0.75rem;
  font-weight: 400;
  letter-spacing: 0.05em;
  color: var(--text-mention-grey);
  background-color: var(--background-overlap-grey, #fff);
}

.fx-dropdown__group-content,
.fx-select__group-content {
  padding: 0;
  margin: 0;
}

.fx-dropdown--sm .fx-dropdown__group-label,
.fx-select--sm .fx-select__group-label {
  padding: 0.375rem 0.75rem 0.25rem;
  font-size: 0.6875rem;
}

.fx-dropdown--lg .fx-dropdown__group-label,
.fx-select--lg .fx-select__group-label {
  padding: 0.625rem 1.5rem 0.25rem;
  font-size: 0.8125rem;
}

/* -----------------------------------------------------------------------------
   Header - title section at top
   ----------------------------------------------------------------------------- */
.fx-dropdown__header,
.fx-select__header {
  flex: 0 0 auto;
  padding: 0.625rem 1rem;
  background-color: var(--background-overlap-grey, #fff);
  box-shadow: inset 0 -1px 0 0 var(--border-default-grey);
}

.fx-dropdown--sm .fx-dropdown__header,
.fx-select--sm .fx-select__header {
  padding: 0.375rem 0.75rem;
  font-size: 0.75rem;
}

.fx-dropdown--lg .fx-dropdown__header,
.fx-select--lg .fx-select__header {
  padding: 0.625rem 1.5rem;
  font-size: 1rem;
}

/* -----------------------------------------------------------------------------
   Footer - actions at the bottom
   ----------------------------------------------------------------------------- */
.fx-dropdown__footer,
.fx-select__footer {
  flex: 0 0 auto;
  display: flex;
  align-items: center;
  gap: 0.5rem;
  padding: 0.5rem 1rem;
  border-top: 1px solid var(--border-default-grey);
  background-color: var(--background-overlap-grey, #fff);
  justify-content: space-between;
}

.fx-dropdown__footer--start,
.fx-select__footer--start {
  justify-content: flex-start;
}

.fx-dropdown__footer--center,
.fx-select__footer--center {
  justify-content: center;
}

.fx-dropdown__footer--end,
.fx-select__footer--end {
  justify-content: flex-end;
}

.fx-dropdown--sm .fx-dropdown__footer,
.fx-select--sm .fx-select__footer {
  padding: 0.25rem 0.75rem;
  gap: 0.5rem;
  font-size: 0.875rem;
}

.fx-dropdown--lg .fx-dropdown__footer,
.fx-select--lg .fx-select__footer {
  padding: 0.5rem 1.5rem;
  gap: 0.625rem;
  font-size: 1.125rem;
}

/* -----------------------------------------------------------------------------
   Search input
   ----------------------------------------------------------------------------- */
.fx-dropdown__search,
.fx-select__search {
  flex: 0 0 auto;
  padding: 0.5rem;
  background-color: var(--background-overlap-grey, #fff);
  border-bottom: 1px solid var(--border-default-grey);
}

.fx-dropdown__search-input,
.fx-select__search-input {
  width: 100%;
  padding: 0.375rem 0.5rem;
  font-size: 0.875rem;
  line-height: 1.5;
  background-color: transparent;
  border: none;
  outline: none;
}

.fx-dropdown__search-input:focus,
.fx-select__search-input:focus {
  outline: none !important;
}

.fx-dropdown__search:focus-within,
.fx-select__search:focus-within {
  outline: 2px solid #0a76f6 !important;
  outline-offset: -2px !important;
}

.fx-dropdown__search-input::placeholder,
.fx-select__search-input::placeholder {
  color: var(--text-mention-grey);
}

.fx-dropdown--sm .fx-dropdown__search,
.fx-select--sm .fx-select__search {
  padding: 0.375rem;
}

.fx-dropdown--sm .fx-dropdown__search-input,
.fx-select--sm .fx-select__search-input {
  font-size: 0.875rem;
  padding: 0.25rem 0.75rem;
}

.fx-dropdown--lg .fx-dropdown__search,
.fx-select--lg .fx-select__search {
  padding: 0.625rem;
}

.fx-dropdown--lg .fx-dropdown__search-input,
.fx-select--lg .fx-select__search-input {
  font-size: 1.125rem;
  padding: 0.5rem 1.5rem;
}

/* -----------------------------------------------------------------------------
   Empty state
   ----------------------------------------------------------------------------- */
.fx-dropdown__empty,
.fx-select__empty {
  display: flex;
  align-items: center;
  justify-content: center;
  padding: 1.5rem 1rem;
  text-align: center;
  color: var(--text-mention-grey);
  font-size: 1rem;
  font-style: italic;
}

.fx-dropdown--sm .fx-dropdown__empty,
.fx-select--sm .fx-select__empty {
  padding: 1rem 0.75rem;
  font-size: 0.875rem;
}

.fx-dropdown--lg .fx-dropdown__empty,
.fx-select--lg .fx-select__empty {
  padding: 2rem 1.5rem;
  font-size: 1.125rem;
}

/* -----------------------------------------------------------------------------
   Loading state
   ----------------------------------------------------------------------------- */
.fx-dropdown__loading,
.fx-select__loading {
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 0.5rem;
  padding: 1.5rem 1rem;
  text-align: center;
  color: var(--text-mention-grey);
  font-size: 1rem;
}

.fx-dropdown__loading [class^="fr-icon-"],
.fx-dropdown__loading [class*=" fr-icon-"],
.fx-select__loading [class^="fr-icon-"],
.fx-select__loading [class*=" fr-icon-"] {
  animation: fx-popover-spin 1s linear infinite;
}

@keyframes fx-popover-spin {
  from {
    transform: rotate(0deg);
  }
  to {
    transform: rotate(360deg);
  }
}

.fx-dropdown--sm .fx-dropdown__loading,
.fx-select--sm .fx-select__loading {
  padding: 1rem 0.75rem;
  gap: 0.5rem;
  font-size: 0.875rem;
}

.fx-dropdown--lg .fx-dropdown__loading,
.fx-select--lg .fx-select__loading {
  padding: 2rem 1.5rem;
  gap: 0.625rem;
  font-size: 1.125rem;
}

/* -----------------------------------------------------------------------------
   Separator
   ----------------------------------------------------------------------------- */
.fx-dropdown__separator,
.fx-select__separator {
  height: 1px;
  margin: 0.25rem 0;
  padding: 0;
  border: none;
  background-color: var(--border-default-grey);
}

/* -----------------------------------------------------------------------------
   Content container - scrollable area (default max-height)
   ----------------------------------------------------------------------------- */
.fx-dropdown__content,
.fx-select__content {
  max-height: 16rem;
  overflow-y: auto;
}

.fx-dropdown--sm .fx-dropdown__content,
.fx-select--sm .fx-select__content {
  max-height: 14rem;
}

.fx-dropdown--lg .fx-dropdown__content,
.fx-select--lg .fx-select__content {
  max-height: 20rem;
}

/* -----------------------------------------------------------------------------
   Dropdown Item - button/link action
   ----------------------------------------------------------------------------- */
.fx-dropdown__item {
  display: flex;
  flex-direction: row;
  align-items: center;
  gap: 0.5rem;
  width: 100%;
  padding: 0.5rem 1rem;
  font-size: 1rem;
  line-height: 1.5;
  font-weight: 400;
  text-align: left;
  white-space: nowrap;
  background-color: transparent;
  border: none;
  cursor: pointer;
  color: var(--text-default-grey);
  text-decoration: none;
}

.fx-dropdown--sm .fx-dropdown__item {
  padding: 0.25rem 0.75rem;
  font-size: 0.875rem;
}

.fx-dropdown--lg .fx-dropdown__item {
  padding: 0.5rem 1.5rem;
  font-size: 1.125rem;
}

.fx-dropdown__item:hover {
  background-color: var(--hover) !important;
}

.fx-dropdown__item:active {
  background-color: var(--active) !important;
}

.fx-dropdown__item:focus {
  outline: 2px solid #0a76f6 !important;
  outline-offset: -2px !important;
}

.fx-dropdown__item:focus:not(:focus-visible) {
  outline: none !important;
}

.fx-dropdown__item:focus-visible {
  outline: 2px solid #0a76f6 !important;
  outline-offset: -2px !important;
}

/* Disable DSFR underline on links */
a.fx-dropdown__item[href],
.fx-dropdown__item a[href] {
  background-image: none;
  background-size: 0;
  --underline-idle-width: 0;
  --underline-hover-width: 0;
}

/* Shadow separator between items (only at root level, not in groups) */
.fx-dropdown__popover-inner > .fx-dropdown__item + .fx-dropdown__item {
  box-shadow: inset 0 1px 0 0 var(--border-default-grey);
}

/* Active/selected state */
.fx-dropdown__item--active,
.fx-dropdown__item[aria-current="true"] {
  color: var(--text-active-blue-france);
  background-color: var(--background-contrast-blue-france);
}

.fx-dropdown__item--active:hover,
.fx-dropdown__item[aria-current="true"]:hover {
  background-color: var(--background-contrast-blue-france-hover);
}

/* Destructive action (red) */
.fx-dropdown__item--destructive {
  color: var(--text-default-error);
}

.fx-dropdown__item--destructive:hover {
  background-color: var(
    --background-contrast-error-hover,
    rgba(206, 5, 0, 0.1)
  );
  color: var(--text-default-error);
}

/* Icon positioning */
.fx-dropdown__item[class*="fr-icon-"]::before {
  --icon-size: 1rem;
  flex: 0 0 auto;
  display: inline-block;
  width: var(--icon-size);
  height: var(--icon-size);
  background-color: currentColor;
  -webkit-mask-size: 100% 100%;
  mask-size: 100% 100%;
  vertical-align: middle;
  order: -1;
}

.fx-dropdown__item--icon-right[class*="fr-icon-"]::before {
  order: 1;
  margin-left: auto;
}

.fx-dropdown--sm .fx-dropdown__item[class*="fr-icon-"]::before {
  --icon-size: 0.875rem;
}

.fx-dropdown--lg .fx-dropdown__item[class*="fr-icon-"]::before {
  --icon-size: 1.125rem;
}

.fx-select__option[class*="fr-icon-"]::before {
  --icon-size: 1rem;
  flex: 0 0 auto;
  display: inline-block;
  width: var(--icon-size);
  height: var(--icon-size);
  background-color: currentColor;
  -webkit-mask-size: 100% 100%;
  mask-size: 100% 100%;
  order: -1;
}

.fx-select__option--icon-right[class*="fr-icon-"]::before {
  order: 1;
  margin-left: auto;
}

.fx-select--sm .fx-select__option[class*="fr-icon-"]::before {
  --icon-size: 0.875rem;
}

.fx-select--lg .fx-select__option[class*="fr-icon-"]::before {
  --icon-size: 1.125rem;
}

/* -----------------------------------------------------------------------------
   Select Option - simple selectable item
   ----------------------------------------------------------------------------- */
.fx-select__option {
  display: flex;
  flex-direction: row;
  align-items: center;
  gap: 0.5rem;
  width: 100%;
  padding: 0.5rem 1rem;
  font-size: 1rem;
  line-height: 1.5rem;
  font-weight: 400;
  text-align: left;
  white-space: normal;
  word-break: break-word;
  background-color: transparent;
  border: none;
  cursor: pointer;
  color: var(--text-default-grey);
  text-decoration: none;
  position: relative;
}

.fx-select--sm .fx-select__option {
  padding: 0.25rem 0.75rem;
  font-size: 0.875rem;
  line-height: 1.5rem;
}

.fx-select--lg .fx-select__option {
  padding: 0.5rem 1.5rem;
  font-size: 1.125rem;
  line-height: 1.75rem;
  gap: 0.625rem;
}

.fx-select__option:hover {
  background-color: var(--hover);
}

.fx-select__option:active {
  background-color: var(--active);
}

.fx-select__option:focus {
  outline: 2px solid #0a76f6 !important;
  outline-offset: -2px !important;
}

.fx-select__option:focus:not(:focus-visible) {
  outline: none !important;
}

.fx-select__option:focus-visible {
  outline: 2px solid #0a76f6 !important;
  outline-offset: -2px !important;
}

.fx-select__option--disabled,
.fx-select__option[aria-disabled="true"] {
  opacity: 0.5;
  cursor: not-allowed;
  pointer-events: none;
}

/* Selected state with blue bar */
.fx-select__option--selected,
.fx-select__option[aria-selected="true"] {
  color: var(--text-active-blue-france);
}

.fx-select__option--selected::before,
.fx-select__option[aria-selected="true"]::before {
  content: "";
  display: block;
  position: absolute;
  left: 0;
  top: 50%;
  margin-top: -0.75rem;
  width: 2px;
  height: 1.5rem;
  background-color: var(--background-active-blue-france);
}

.fx-select__option--selected:hover,
.fx-select__option[aria-selected="true"]:hover {
  background-color: var(--hover);
}

/* -----------------------------------------------------------------------------
   Select Checkbox - multi-select option
   ----------------------------------------------------------------------------- */
.fx-select__checkbox {
  display: flex;
  flex-direction: row;
  align-items: center;
  gap: 0.625rem;
  width: 100%;
  padding: 0.5rem 1rem;
  font-size: 1rem;
  line-height: 1.5rem;
  background-color: transparent;
  border: none;
  cursor: pointer;
  color: var(--text-default-grey);
  text-align: left;
}

.fx-select__checkbox:hover {
  background-color: var(--hover);
}

.fx-select__checkbox:focus {
  outline: 2px solid #0a76f6 !important;
  outline-offset: -2px !important;
}

.fx-select__checkbox:focus:not(:focus-visible) {
  outline: none !important;
}

.fx-select__checkbox:focus-visible {
  outline: 2px solid #0a76f6 !important;
  outline-offset: -2px !important;
}

.fx-select__checkbox input[type="checkbox"] {
  flex: 0 0 auto;
  width: 1rem;
  height: 1rem;
  margin: 0.125rem 0 0 0;
  pointer-events: none;
  accent-color: var(--background-active-blue-france);
}

.fx-select__checkbox-label {
  flex: 1 1 auto;
  cursor: pointer;
}

.fx-select--sm .fx-select__checkbox {
  padding: 0.25rem 0.75rem;
  font-size: 0.875rem;
  line-height: 1.5rem;
  gap: 0.5rem;
}

.fx-select--lg .fx-select__checkbox {
  padding: 0.5rem 1.5rem;
  font-size: 1.125rem;
  line-height: 1.75rem;
  gap: 0.75rem;
}

.fx-select__checkbox--disabled {
  opacity: 0.5;
  cursor: not-allowed;
}

.fx-select__checkbox--disabled:hover {
  background-color: transparent;
}

/* -----------------------------------------------------------------------------
   Select Radio - single-select with radio visual
   ----------------------------------------------------------------------------- */
.fx-select__radio {
  display: flex;
  flex-direction: row;
  align-items: center;
  gap: 0.625rem;
  width: 100%;
  padding: 0.5rem 1rem;
  font-size: 1rem;
  line-height: 1.5rem;
  background-color: transparent;
  border: none;
  cursor: pointer;
  color: var(--text-default-grey);
  text-align: left;
}

.fx-select__radio:hover {
  background-color: var(--hover);
}

.fx-select__radio:focus {
  outline: 2px solid #0a76f6 !important;
  outline-offset: -2px !important;
}

.fx-select__radio:focus:not(:focus-visible) {
  outline: none !important;
}

.fx-select__radio:focus-visible {
  outline: 2px solid #0a76f6 !important;
  outline-offset: -2px !important;
}

.fx-select__radio input[type="radio"] {
  flex: 0 0 auto;
  width: 1rem;
  height: 1rem;
  margin: 0.125rem 0 0 0;
  cursor: pointer;
  accent-color: var(--background-active-blue-france);
}

.fx-select__radio-label {
  flex: 1 1 auto;
  cursor: pointer;
}

.fx-select--sm .fx-select__radio {
  padding: 0.25rem 0.75rem;
  font-size: 0.875rem;
  line-height: 1.5rem;
  gap: 0.5rem;
}

.fx-select--lg .fx-select__radio {
  padding: 0.5rem 1.5rem;
  font-size: 1.125rem;
  line-height: 1.75rem;
  gap: 0.75rem;
}

.fx-select__radio--disabled {
  opacity: 0.5;
  cursor: not-allowed;
}

.fx-select__radio--disabled:hover {
  background-color: transparent;
}
